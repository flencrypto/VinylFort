<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Deal Finder - VinylVault Pro</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <!-- Preload critical resources -->
    <link rel="preload" href="components/vinyl-nav.js" as="script">
    <link rel="preload" href="components/vinyl-footer.js" as="script">
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#7c3aed',
                        secondary: '#06b6d4',
                        accent: '#f59e0b',
                        surface: '#0f172a',
                        'surface-light': '#1e293b',
                        profit: '#22c55e',
                        loss: '#ef4444',
                        deal: '#ec4899',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-surface text-gray-100 min-h-screen">
    <!-- Navigation -->
    <vinyl-nav></vinyl-nav>

    <!-- Main Content -->
    <main class="pt-20 pb-12 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
        
        <!-- Page Header -->
        <section class="mb-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div>
                    <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-deal/10 border border-deal/30 mb-4">
                        <i data-feather="search" class="w-4 h-4 text-deal"></i>
                        <span class="text-sm font-medium text-deal">Investment Analysis Tool</span>
                    </div>
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-deal via-primary to-secondary bg-clip-text text-transparent mb-2">
                        Deal Finder
                    </h1>
                    <p class="text-gray-400">Identify undervalued records, analyze potential flips, and calculate profit margins before you buy.</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="importFromCSV()" class="px-4 py-2 bg-surface-light border border-gray-600 rounded-lg font-medium hover:border-deal hover:text-deal transition-all flex items-center gap-2">
                        <i data-feather="file-text" class="w-4 h-4"></i>
                        Import Discogs Wantlist
                    </button>
                </div>
            </div>
        </section>

        <!-- Quick Deal Calculator -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <div class="lg:col-span-2 bg-surface-light rounded-2xl p-6 border border-gray-800">
                <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <i data-feather="calculator" class="w-5 h-5 text-deal"></i>
                    Quick Flip Calculator
                </h2>
                <div class="grid sm:grid-cols-2 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Purchase Price (£)</label>
                        <input type="number" id="calcBuyPrice" placeholder="0.00" step="0.01" 
                            class="w-full px-3 py-2 bg-surface border border-gray-700 rounded-lg focus:border-deal focus:outline-none text-sm"
                            oninput="calculateDeal()">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Est. Resale (£)</label>
                        <input type="number" id="calcResalePrice" placeholder="0.00" step="0.01" 
                            class="w-full px-3 py-2 bg-surface border border-gray-700 rounded-lg focus:border-deal focus:outline-none text-sm"
                            oninput="calculateDeal()">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Condition</label>
                        <select id="calcCondition" onchange="calculateDeal()" class="w-full px-3 py-2 bg-surface border border-gray-700 rounded-lg focus:border-deal focus:outline-none text-sm">
                            <option value="M">M (Mint)</option>
                            <option value="NM">NM (Near Mint)</option>
                            <option value="VG+">VG+</option>
                            <option value="VG" selected>VG (Very Good)</option>
                            <option value="G+">G+</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Selling Goal</label>
                        <select id="calcGoal" onchange="calculateDeal()" class="w-full px-3 py-2 bg-surface border border-gray-700 rounded-lg focus:border-deal focus:outline-none text-sm">
                            <option value="quick">Quick Sale</option>
                            <option value="balanced" selected>Balanced</option>
                            <option value="max">Maximum Profit</option>
                        </select>
                    </div>
                </div>
                <div id="dealResult" class="mt-6 p-4 rounded-xl bg-gray-800/50 border border-gray-700 hidden">
                    <!-- Results populated by JS -->
                </div>
            </div>

            <!-- Market Trends -->
            <div class="bg-gradient-to-br from-deal/10 to-primary/10 rounded-2xl p-6 border border-deal/20">
                <h2 class="text-lg font-semibold mb-4 text-deal">Deal Indicators</h2>
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-3 bg-surface rounded-lg">
                        <span class="text-sm text-gray-400">Target Margin</span>
                        <span class="font-bold text-profit">30%+</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-surface rounded-lg">
                        <span class="text-sm text-gray-400">Min Profit/Record</span>
                        <span class="font-bold text-profit">£3+</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-surface rounded-lg">
                        <span class="text-sm text-gray-400">Fast Flip Criteria</span>
                        <span class="font-bold text-warning">50%+ margin</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-surface rounded-lg">
                        <span class="text-sm text-gray-400">Hold Threshold</span>
                        <span class="font-bold text-primary">£20+ value</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bulk Deal Analyzer -->
        <div class="bg-surface-light rounded-2xl p-6 border border-gray-800 mb-8">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-xl font-semibold flex items-center gap-2">
                        <i data-feather="zap" class="w-5 h-5 text-accent"></i>
                        Bulk Deal Analyzer
                    </h2>
                    <p class="text-sm text-gray-500 mt-1">Paste a Discogs marketplace search or seller's list to analyze multiple deals at once</p>
                </div>
                <input type="file" id="bulkCSVInput" accept=".csv" class="hidden" onchange="handleBulkCSV(event)">
                <button onclick="document.getElementById('bulkCSVInput').click()" class="px-4 py-2 bg-surface border border-gray-600 rounded-lg text-sm hover:border-primary hover:text-primary transition-all flex items-center gap-2">
                    <i data-feather="upload" class="w-4 h-4"></i>
                    Upload CSV
                </button>
            </div>
            <div class="space-y-4">
                <div class="relative">
                    <div id="bulkDropZone" class="border-2 border-dashed border-gray-600 rounded-xl p-8 text-center transition-all hover:border-deal hover:bg-deal/5 cursor-pointer">
                        <i data-feather="upload-cloud" class="w-10 h-10 text-gray-500 mx-auto mb-3"></i>
                        <p class="text-gray-300 font-medium mb-2">Drop files here or paste text below</p>
                        <p class="text-sm text-gray-500 mb-4">Supports: CSV files, text files with URLs, or paste listings directly</p>
                        <textarea id="bulkInput" rows="4" placeholder="Paste seller listings, marketplace URLs, or record details (one per line)... &#10;Example:&#10;Pink Floyd - Dark Side of the Moon - £15&#10;The Beatles - Abbey Road VG+ - £25&#10;https://www.discogs.com/sell/item/123456"
                            class="w-full px-4 py-3 bg-surface border border-gray-700 rounded-lg focus:border-deal focus:outline-none text-sm font-mono resize-y text-left"></textarea>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button onclick="analyzeBulkDeals()" class="px-6 py-3 bg-gradient-to-r from-deal to-pink-600 rounded-lg font-medium hover:shadow-lg hover:shadow-deal/25 transition-all flex items-center gap-2">
                        <i data-feather="search" class="w-4 h-4"></i>
                        Analyze Deals
                    </button>
                    <button onclick="clearBulkInput()" class="px-4 py-3 border border-gray-600 rounded-lg text-gray-400 hover:text-white transition-all">
                        Clear
                    </button>
                </div>
            </div>
</div>

        <!-- Analysis Results -->
        <div id="dealsResults" class="hidden space-y-6">
            <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold">Analysis Results</h3>
                <div class="flex gap-2">
                    <span id="hotDealsCount" class="px-3 py-1 bg-profit/20 text-profit rounded-full text-sm font-medium">0 Hot Deals</span>
                    <span id="skipCount" class="px-3 py-1 bg-loss/20 text-loss rounded-full text-sm font-medium">0 Pass</span>
                </div>
            </div>
            
            <div id="dealsGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                <!-- Dynamically populated -->
            </div>
        </div>

        <!-- Empty State -->
        <div id="dealsEmptyState" class="text-center py-16">
            <div class="w-24 h-24 mx-auto mb-6 rounded-2xl bg-surface-light border border-gray-700 flex items-center justify-center">
                <i data-feather="trending-up" class="w-12 h-12 text-gray-600"></i>
            </div>
            <h3 class="text-xl font-medium text-gray-300 mb-2">Find your next flip</h3>
            <p class="text-gray-500 max-w-md mx-auto mb-6">
                Enter a record's details to instantly calculate potential profit, or import a seller's list to batch-analyze opportunities.
            </p>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 max-w-2xl mx-auto">
                <div class="p-4 bg-surface-light rounded-xl border border-gray-700 text-center">
                    <i data-feather="check-circle" class="w-8 h-8 text-profit mx-auto mb-2"></i>
                    <p class="text-sm text-gray-300">30%+ margin recommended</p>
                </div>
                <div class="p-4 bg-surface-light rounded-xl border border-gray-700 text-center">
                    <i data-feather="clock" class="w-8 h-8 text-accent mx-auto mb-2"></i>
                    <p class="text-sm text-gray-300">Consider days to sell</p>
                </div>
                <div class="p-4 bg-surface-light rounded-xl border border-gray-700 text-center">
                    <i data-feather="dollar-sign" class="w-8 h-8 text-deal mx-auto mb-2"></i>
                    <p class="text-sm text-gray-300">£3 min profit per record</p>
                </div>
            </div>
        </div>

    </main>

    <!-- Deal Detail Modal -->
    <div id="dealModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div class="bg-surface-light rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-800">
            <div class="p-6 border-b border-gray-800 flex items-center justify-between">
                <h2 class="text-xl font-semibold">Deal Analysis</h2>
                <button onclick="closeDealModal()" class="text-gray-400 hover:text-white">
                    <i data-feather="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div id="dealModalContent" class="p-6">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Auto-Buy Confirmation Modal -->
    <div id="autoBuyModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center p-4">
        <div class="bg-surface-light rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border border-gray-800">
            <div class="p-6 border-b border-gray-800 flex items-center justify-between">
                <h2 class="text-xl font-semibold">Auto-Buy Confirmation</h2>
                <button onclick="closeAutoBuyModal()" class="text-gray-400 hover:text-white">
                    <i data-feather="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div id="autoBuyModalContent" class="p-6">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <vinyl-footer></vinyl-footer>

    <!-- Scripts -->
    <script src="components/vinyl-nav.js"></script>
    <script src="components/vinyl-footer.js"></script>
    <script src="components/stat-card.js"></script>
    <script src="components/discogs-service.js"></script>
    <script src="script.js"></script>
    <script src="deals.js"></script>
    <script>feather.replace();</script>
</body>
</html>
